<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>ConstroiVerse â€” Construtora</title>
  <link rel="stylesheet" href="/static/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="painel-construtora">

  <header>
    <h1>ğŸ—ï¸ ConstroiVerse â€” Painel da Construtora</h1>
    <p>GestÃ£o total da obra, equipe e suprimentos</p>
  </header>

  <main>

    <!-- OBRAS EM ANDAMENTO -->
    <section class="bloco bloco-obras">
      <h2>ğŸ“‹ Obras Ativas</h2>
      <ul>
        <li>Obra #001 â€” Residencial Vila Verde â€” 75% concluÃ­da</li>
        <li>Obra #004 â€” PrÃ©dio Comercial Aurora â€” 28% concluÃ­da</li>
      </ul>
    </section>

    <!-- ORÃ‡AMENTO INTELIGENTE POR PROJETO -->
    <section class="bloco bloco-projeto-inteligente">
      <h2>ğŸ“ Solicitar OrÃ§amento Inteligente por Projeto</h2>
      <input type="file" id="projeto_pdf" />
      <textarea id="descricao_projeto" placeholder="Descreva o projeto ou os insumos desejados..."></textarea>
      <button onclick="gerarOrcamentoInteligente()">âœ¨ Gerar OrÃ§amento com IA</button>
      <pre id="resultado_orcamento">Aguardando entrada do projeto...</pre>
      <button onclick="enviarPedidos()" style="margin-top: 10px;">ğŸ“¤ Enviar Pedidos para Fornecedores</button>
    </section>

    <!-- FERRAMENTAS DA CONSTRUTORA -->
    <section class="bloco bloco-ferramentas">
      <h2>ğŸ› ï¸ Ferramentas da Construtora</h2>
      <ul>
        <li>ğŸ“¦ OrÃ§amentos fragmentados por estoque real</li>
        <li>ğŸ§  IA que entende projetos e sugere fornecedores ideais</li>
        <li>ğŸ“Š Painel de ROI por obra e por fornecedor</li>
        <li>ğŸ‘· GestÃ£o de profissionais e convites diretos</li>
      </ul>
    </section>

  </main>

  <footer>
    <p>ConstroiVerse Â© 2025 â€” Construtora Conectada</p>
  </footer>

  <script src="/static/dashboard.js"></script>
  <script>
    async function gerarOrcamentoInteligente() {
      const descricao = document.getElementById('descricao_projeto').value;
      const fileInput = document.getElementById('projeto_pdf');
      const resultado = document.getElementById('resultado_orcamento');
      resultado.innerText = "â³ Gerando orÃ§amento...";

      let mensagem = `Sou construtora. Monte um orÃ§amento completo com base no seguinte projeto: ${descricao}. 
      - Fragmentar por fornecedor (lojas e fabricantes)
      - Separar o que pode ser comprado direto com CNPJ
      - Ignorar lojas sem estoque
      - Indicar origem ideal de cada item
      - Mostrar total por grupo (fabricante X, loja Y)`;

      if (fileInput.files.length > 0) {
        mensagem = "Sou construtora. Monte um orÃ§amento com base em um projeto PDF (nÃ£o processado neste demo).";
      }

      const res = await fetch('/ia/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ descricao: mensagem })
      });

      const data = await res.json();
      resultado.innerText = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
    }

    function enviarPedidos() {
      const orcamento = document.getElementById('resultado_orcamento').innerText;
      if (!orcamento || orcamento.includes('â³')) {
        alert('Gere o orÃ§amento antes de enviar!');
        return;
      }
      alert('âœ… Pedidos enviados para os fornecedores correspondentes!');
      // (opcional: POST para /pedidos/fragmentar)
    }
  </script>
</body>
</html>