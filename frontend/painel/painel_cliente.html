<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>ConstroiVerse â€” Minha Obra</title>
  <link rel="stylesheet" href="/static/style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body class="painel-cliente">

  <header>
    <h1>ğŸ  ConstroiVerse â€” Minha Obra</h1>
    <p>Acompanhe sua construÃ§Ã£o em tempo real</p>
    <button onclick="sair()">ğŸšª Sair</button>
  </header>

  <main>

    <!-- MINHAS OBRAS -->
    <section class="bloco bloco-obras">
      <h2>ğŸ” Minhas Obras</h2>
      <ul id="lista-obras">Carregando obras...</ul>
    </section>

    <!-- ORÃ‡AMENTO -->
    <section class="bloco bloco-orcamento">
      <h2>ğŸ›’ Solicitar OrÃ§amento</h2>
      <select id="loja">
        <option value="Construmais">Loja Construmais</option>
        <option value="Brasil MatCom">Brasil MatCom</option>
      </select><br><br>
      <textarea id="lista-itens" placeholder="Ex: 20 sacos de cimento, 10 metros de piso 60x60..."></textarea><br>
      <button onclick="enviarOrcamento()">ğŸ“¨ Enviar</button>
    </section>

    <!-- SOLICITAR PROFISSIONAL -->
    <section class="bloco bloco-profissionais">
      <h2>ğŸ§‘â€ğŸ”§ Solicitar Profissional da Vitrine</h2>
      <select id="categoria">
        <option>Pedreiro</option>
        <option>Pintor</option>
        <option>Eletricista</option>
        <option>Encanador</option>
        <option>Arquiteto</option>
        <option>Engenheiro</option>
      </select><br><br>
      <button onclick="solicitarProfissional()">ğŸ“© Solicitar</button>
    </section>

    <!-- AVALIAÃ‡ÃƒO -->
    <section class="bloco bloco-avaliacao">
      <h2>âœ… Avaliar Profissionais</h2>
      <textarea id="avaliacao" placeholder="Sua opiniÃ£o sobre a obra e a equipe..."></textarea><br>
      <button onclick="avaliar()">Enviar AvaliaÃ§Ã£o</button>
    </section>

  </main>

  <footer>
    <p>ConstroiVerse Â© 2025 â€” TransparÃªncia do inÃ­cio ao fim</p>
  </footer>

  <script src="/static/dashboard.js"></script>
  <script>
    async function carregarObras() {
      const obras = await fetchAutenticado("/api/obras");
      preencherLista("lista-obras", obras, obra => `
        <strong>${obra.nome || "Sem nome"}</strong><br>
        Status: ${obra.status || "Em andamento"}<br>
        Ãšltima atualizaÃ§Ã£o: ${obra.updated_at || "Hoje"}<br>
      `);
    }

    async function enviarOrcamento() {
      const loja = document.getElementById("loja").value;
      const itens = document.getElementById("lista-itens").value;
      if (!itens) return alert("Escreva os itens desejados.");
      await fetchAutenticado("/api/orcamentos", "POST", {
        loja,
        itens,
        cliente: "consumidor_final"
      });
      alert("âœ… Pedido de orÃ§amento enviado!");
    }

    async function solicitarProfissional() {
      const categoria = document.getElementById("categoria").value;
      await fetchAutenticado("/api/vitrine", "GET"); // Aqui sÃ³ simula, IA pode responder depois
      alert(`ğŸ“© SolicitaÃ§Ã£o de ${categoria} enviada! Aguarde retorno.`);
    }

    async function avaliar() {
      const texto = document.getElementById("avaliacao").value;
      if (!texto) return alert("Escreva sua avaliaÃ§Ã£o.");
      await fetchAutenticado("/api/avaliacoes", "POST", {
        avaliacao: texto,
        obra_id: "cliente"
      });
      alert("âœ… AvaliaÃ§Ã£o registrada!");
    }

    carregarObras();
  </script>
</body>
</html>